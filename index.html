<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <title>Big Musiciens</title>
  <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
  <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.2/lodash.min.js'></script>
  <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js'></script>
  <script type="text/template" id='template-musicians'>
    <li><a href="musicians.php?id=<%= id %>"><%= first_name %> <%= last_name %></a></li>
  </script>
</head>
<body>
<ul id='musicians-list'></ul>
<script type="text/javascript">
  (function ($, Backbone) {
    var MusiciansModel = Backbone.Model.extend({
      default: {
        first_name: '',
        last_name: ''
      }
    });

    var MusiciansCollection = Backbone.Collection.extend({
      model: MusiciansModel
    });

    var MusicianView = Backbone.View.extend({
      tagName: 'li'
    });

    var MusicianListView = Backbone.View.extend({
      collection: null,
      template: _.template( $('#template-musicians').html() ),
      initialize: function () {
        this.listenTo(this.collection, 'add', this.render);
        this.render();
      },
      render: function () {
        var self = this;

        self.$el.empty();
        this.collection.each(function (musician) {
          self.$el.append( self.template(musician.toJSON()) );
        })
      }
    })

    $(function () {
      var main = function () {
        var musicians = new MusiciansCollection();

        var musiciansList = new MusicianListView({
          el: '#musicians-list',
          collection: musicians
        });

        musicians.add(new MusiciansModel({id:1, first_name:'Maurice', last_name:'Andre'}));
        musicians.add(new MusiciansModel({id:2, first_name:'Louis', last_name:'Amstrong'}));
        musicians.add(new MusiciansModel({id:3, first_name:'Eric', last_name:'Aubier'}));
        musicians.add(new MusiciansModel({id:4, first_name:'Miles', last_name:'Davis'}));
        musicians.add(new MusiciansModel({id:5, first_name:'Arturo', last_name:'Sandoval'}));
        musicians.add(new MusiciansModel({id:6, first_name:'James', last_name:'Morrison'}));

        $('#waiting').remove();

      };

      $('body').append('<h1 id="waiting">Merci de Patienter un moment</h1>');

      setTimeout(main, 2000);
    })


  })(jQuery, Backbone)
</script>
</body>
</html>
